<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>File Upload via WebSocket</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
    <form id="fileForm">
        <input type="text" id="fileId" placeholder="File ID" required><br>
        <input type="text" id="type" placeholder="File Type" required><br>
        <input type="file" id="file" required><br>
        <button type="submit">Upload File</button>
    </form>

    <div id="status"></div>

    <script>
        const socket = new SockJS('http://localhost:8080/fileUpload');
        const stompClient = Stomp.over(socket);

        stompClient.connect({}, () => {
            // Status mesajlarını dinleyin
            stompClient.subscribe('/topic/fileUploadStatus', (message) => {
                document.getElementById('status').innerText = message.body;
            });
        });

        document.getElementById('fileForm').onsubmit = function (e) {
            e.preventDefault();
            const fileInput = document.getElementById('file');
            const fileId = document.getElementById('fileId').value;
            const type = document.getElementById('type').value;

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('fileId', fileId);
            formData.append('type', type);

            const reader = new FileReader();
            reader.onload = function () {
                const fileUploadDto = {
                    fileId: fileId,
                    type: type,
                    file: {
                        originalFilename: fileInput.files[0].name,
                        content: reader.result.split(',')[1],
                    }
                };
                stompClient.send("/app/uploadFile", {}, JSON.stringify(fileUploadDto));
            };
            reader.readAsDataURL(fileInput.files[0]);
        };
    </script>
</body>
</html>
